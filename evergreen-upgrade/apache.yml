# Apache
- name: Setup eg.conf
  become: true
  copy:
    remote_src: true
    src: "{{eg_dir}}/Open-ILS/examples/apache_24/eg_24.conf"
    dest: /etc/apache2/sites-available/eg.conf
- name: Setup eg_vhost.conf
  become: true
  copy:
    remote_src: true
    src: "{{eg_dir}}/Open-ILS/examples/apache_24/eg_vhost_24.conf"
    dest: /etc/apache2/eg_vhost.conf 
- name: Setup eg_startup
  become: true
  copy:
    remote_src: true
    src: "{{eg_dir}}/Open-ILS/examples/apache/eg_startup"
    dest: /etc/apache2/              
- name: Disable mpm_event
  become: true
  shell: /usr/sbin/a2dismod mpm_event
- name: Enable mpm_prefork
  become: true
  shell: /usr/sbin/a2enmod mpm_prefork
- name: Enable apache mod deflate
  become: true
  shell: /usr/sbin/a2enmod deflate
- name: Enable apache mod headers
  become: true
  shell: /usr/sbin/a2enmod headers
- name: Enable apache mod expires
  become: true
  shell: /usr/sbin/a2enmod expires
- name: Enable apache mod rewrite
  become: true
  shell: /usr/sbin/a2enmod rewrite
- name: Disable default site for apache
  become: true
  shell: /usr/sbin/a2dissite 000-default
- name: Enable eg.conf site for apache
  become: true
  shell: /usr/sbin/a2ensite eg.conf
- name: Change ownership of /var/lock/apache2 to opensrf
  become: true
  file: path=/var/lock/apache2 owner=opensrf group=opensrf
- name: Change run-user for apache to opensrf
  become: true
  replace: 
    dest: /etc/apache2/envvars
    regexp: 'www-data'
    replace: 'opensrf'
- name: Set KeepAliveTimeout value
  become: true
  replace: 
    dest: /etc/apache2/apache2.conf
    regexp: 'KeepAliveTimeout .*' 
    replace: 'KeepAliveTimeout 1'
# Leave Apache's stopped until Evergreen services are started.
